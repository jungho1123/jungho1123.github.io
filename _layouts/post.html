{% if page.header.overlay_color or page.header.overlay_image or page.header.image %}
  {% include page__hero.html %}
{% elsif page.header.video.id and page.header.video.provider %}
  {% include page__hero_video.html %}
{% endif %}

{% if page.url != "/" and site.breadcrumbs %}
  {% unless paginator %}
    {% include breadcrumbs.html %}
  {% endunless %}
{% endif %}

<div id="main" role="main">
  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    {% if page.title %}<h1 class="page__title" itemprop="headline">{{ page.title | markdownify | remove: "<p>" | remove: "</p>" }}</h1>{% endif %}
    <div style="border: 2px solid red; padding: 10px; margin: 20px 0; background-color: #ffeeee;">
  <p><b>[디버깅 정보]</b></p>
  <p><b>현재 페이지 언어 (page.lang):</b> {{ page.lang }}</p>
  <p><b>현재 페이지 REF (page.ref):</b> {{ page.ref }}</p>
  <hr>
  <p><b>site.posts 에서 찾는 중... (총 {{ site.posts | size }}개)</b></p>
  <ul>
    {% for p in site.posts %}
      <li>"{{ p.title }}" (REF: {{ p.ref }})</li>
    {% endfor %}
  </ul>
</div>
    <div style="margin-bottom: 20px;">
  {% comment %} 현재 페이지의 ref 값이 있는지 먼저 확인합니다. {% endcomment %}
  {% if page.ref %}
    {% if page.lang == 'ko' %}
      {% assign ja_post = site.ja_posts | where: "ref", page.ref | first %}
      {% if ja_post %}
        <a href="{{ ja_post.url | relative_url }}" class="btn btn--inverse">日本語で読む</a>
      {% endif %}
    {% elsif page.lang == 'ja' %}
      {% assign ko_post = site.posts | where: "ref", page.ref | first %}
      {% if ko_post %}
        <a href="{{ ko_post.url | relative_url }}" class="btn btn--inverse">한국어로 읽기</a>
      {% endif %}
    {% endif %}
  {% endif %}
</div>
    <div class="page__inner-wrap">
      {% unless page.header.overlay_color or page.header.overlay_image %}
        <header>
          {% if page.read_time %}
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> {% include read-time.html %}</p>
          {% endif %}
        </header>
      {% endunless %}

      <section class="page__content" itemprop="text">
        {{ content }}
        {% if page.link %}<div><a href="{{ page.link }}" class="btn btn--primary">{{ site.data.ui-text[site.locale].ext_link_label | default: "Direct Link" }}</a></div>{% endif %}
      </section>

      <footer class="page__meta">
        {% if page.last_modified_at %}
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> {{ site.data.ui-text[site.locale].date_label | default: "Updated:" }}</strong> <time datetime="{{ page.last_modified_at | date_to_xmlschema }}">{{ page.last_modified_at | date: "%B %d, %Y" }}</time></p>
        {% elsif page.date %}
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> {{ site.data.ui-text[site.locale].date_label | default: "Updated:" }}</strong> <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%B %d, %Y" }}</time></p>
        {% endif %}
      </footer>

      {% if page.share %}{% include social-share.html %}{% endif %}

      {% include post_pagination.html %}
    </div>

    {% if site.comments.provider and page.comments %}
      {% include comments.html %}
    {% endif %}

    {% if page.related %}
      <div class="page__related">
        <h4 class="page__related-title">{{ site.data.ui-text[site.locale].related_label | default: "You May Also Enjoy" }}</h4>
        <div class="grid__wrapper">
          {% for post in site.related_posts limit:4 %}
            {% include archive-single.html type="grid" %}
          {% endfor %}
        </div>
      </div>
    {% endif %}

  </article>

</div>